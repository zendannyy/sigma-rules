title: Suspicious Package Manager Repository Modifications
id: ae48a614-07bf-4c55-ad40-2ca0391cb28f
status: experimental
description: |
    Detection attempts to modify package manager configurations to point to potentially malicious
    repositories, enabling supply chain attacks through dependency confusion.
references:
  - https://owasp.org/www-project-top-10-ci-cd-security-risks/CICD-SEC-03-Dependency-Chain-Abuse
logsource:
    product: github
    category: file_event
detection:
    selection_npm:
        TargetFilename|endswith: 
            - '.npmrc'
            - 'package.json'
        EventType: 'FileModify'
    selection_maven:
        TargetFilename|contains:
            - 'pom.xml'
            - 'settings.xml'
    selection_suspicious_repos:
        FileContent|contains:
            - 'registry=http://'
            - 'index-url=http://'
            - 'extra-index-url'
    selection_pip:
        TargetFilename|contains:
            - 'pip.conf'
            - 'pip.ini'
            - 'requirements.txt'
    selection_toml:
        TargetFilename|contains:
            - '.toml'

    condition: 1 of selection_* and selection_suspicious_repos
level: medium
