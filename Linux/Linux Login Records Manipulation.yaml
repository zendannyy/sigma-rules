title: Linux Login Records Manipulation
id: c23fe3cf-6d3b-4fba-adad-76ea43fc05b3
status: experimental
description: |
    Detects adversaries directly manipulating Linux login files to remove evidence of unauthorized access. These
    binary files record successful logins (wtmp), current sessions (utmp), and failed attempts (btmp).

    Sophisticated attackers target these files because they're primary
    forensic artifacts for login tracking. Unlike clearing logs with rm
    (which deletes the file), this technique involves editing
    to remove specific entries while leaving the file structure intact.

    Common manipulation methods include: utmp-specific
    cleaners, and overwriting entries with null bytes,
references:
    - https://attack.mitre.org/techniques/T1070/002/
    - https://sandflysecurity.com/blog/using-linux-utmpdump-for-forensics-and-detecting-log-file-tampering
author: Detection Engineering
date: 2026-02-16
tags:
    - attack.defense-evasion
    - attack.t1070.002
logsource:
    product: linux
    category: process_creation

detection:
    # Binary editors targeting utmp files
    selection_binary_edit:
        Image|endswith:
            - '/hexedit'
            - '/hexdump'
            - '/xxd'
            - '/od'       # octal dump
            - '/bvi'      # binary visual editor
            - '/ghex'     # GNOME hex editor
        CommandLine|contains:
            - 'utmp'
            - 'wtmp'
            - 'btmp'

    # Direct file manipulation of login records
    selection_direct_edit:
        Image|endswith:
            - '/sed'
            - '/awk'
            - '/vi'
        CommandLine|contains:
            - '/var/log/wtmp'
            - '/var/log/btmp'
            - '/var/run/utmp'

    # Specialized utmp manipulation tools (red team tools)
    selection_utmp_tools:
        CommandLine|contains:
            - 'utmpedit'
            - 'wtmpedit'
            - 'utmpclean'
            - 'wtmpclean'
            - 'cleanlogs'
            - 'zap2'      # Classic log cleaner

    # Suspicious operations on login database files
    selection_suspicious_ops:
        Image|endswith:
            - '/dd'
            - '/truncate'
            - '/cp'
        CommandLine|contains:
            - '/var/log/wtmp'
            - '/var/log/btmp'
            - '/var/run/utmp'
            - 'if=/dev/null'    # dd if=/dev/null of=/var/log/wtmp
            - 'if=/dev/zero'

    # Overwriting utmp files with null data
    selection_null_overwrite:
        CommandLine|contains:
            - '> /var/log/wtmp'
            - '>/var/log/wtmp'
            - '> /var/log/btmp'
            - '>/var/log/btmp'
            - '> /var/run/utmp'
            - '>/var/run/utmp'

    condition: >-
        selection_binary_edit or
        selection_direct_edit or
        selection_utmp_tools or
        selection_suspicious_ops or
        selection_null_overwrite

falsepositives:
    - System administrators performing legitimate maintenance on corrupted
      utmp files (correlate with change management tickets)
    - Log rotation scripts that recreate utmp files (logrotate)
    - Forensic analysts examining utmp files during incident response

level: high