title: Gatekeeper Bypass via Shell Script Execution from DMG
id: 005d7198-9033-4107-b99e-7cacc30ee825
status: experimental  
description: |
    Detects execution of shell scripts from mounted disk images (DMG), a technique
    used to bypass Gatekeeper restrictions after macOS Sequoia updates.
references:
    - https://redcanary.com/threat-detection-report/trends/mac-malware/
    - https://www.sentinelone.com/blog/2024-macos-malware-review-infostealers-backdoors-and-apt-campaigns-targeting-the-enterprise/
tags:
    - attack.defense-evasion
    - attack.t1553.001  # Gatekeeper Bypass
logsource:
    product: macos
    category: process_creation
detection:
    selection_shell_execution:
        Image|endswith:
            - '/bash'
            - '/sh'
            - '/zsh'
        ParentImage|endswith: '/Terminal'
    selection_dmg_source:
        CommandLine|contains:
            - '/Volumes/'
        CurrentDirectory|contains:
            - '/Volumes/'
    selection_suspicious_scripts:
        CommandLine|contains:
            - '.command'
            - '.sh'
            - 'installer'
            - 'setup'
    condition: 1 of selection_shell_execution and 1 of selection_dmg_source and 1 of selection_suspicious_scripts
level: medium

