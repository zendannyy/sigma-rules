title: Encoded PowerShell Patterns
logsource:
    product: windows
    category: process_creation
detection:
    selection_powershell:
        Image|endswith:
            - '\powershell.exe'
            - '\pwsh'
    # Encoded command indicators
    selection_encoded:
        CommandLine|contains:
            - '-E'
            - '-enc'
            - '-e'
            - '/enc:'
    selection_base64_suspicious:
        CommandLine|contains:
            - 'JAB'   # Common base64 prefix
            - 'SUVYI' # Common base64 prefix for IEX
            - 'SQBFAFgA'  # Base64 for "IEX"
            - 'aWV4'  # Base64 for "iex"
    condition: any of selection_*
level: high
