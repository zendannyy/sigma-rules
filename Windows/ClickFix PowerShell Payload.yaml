title: ClickFix PowerShell Payload
id: 5c8a1fa3-4a8f-4f4d-9e3d-0b7b1f3e9c11
description: Detects ClickFix-style PowerShell payloads based on command-line patterns and fake error prompts.
status: experimental
author: zendannyy
references:
  - https://www.proofpoint.com/us/blog/threat-insight/security-brief-clickfix-social-engineering-technique-floods-threat-landscape
tags:
  - attack.t1204.002
  - attack.t1059.001
logsource:
  product: windows
  category: process_creation

detection:
  selection_click:
    CommandLine|contains:
      - 'Windows+R'
      - 'press Windows key + R'
      - 'Run dialog'
      - 'paste the following'
      - 'copy and paste'

  selection_ps:
    CommandLine|contains:
      - 'powershell.exe -w hidden'
      - 'powershell -windowstyle hidden'
      - 'powershell -nop -w hidden -ep bypass'
      - 'IEX (New-Object Net.WebClient).DownloadString'
      - '[Convert]::FromBase64String'

  selection_obf:
    CommandLine|contains:
      - '-encodedcommand'
      - '-enc '
      - 'invoke-expression'
      - 'iex('

  selection_err_1:
    CommandLine|contains: 'Error Code'
  selection_err_2:
    CommandLine|contains: 'verification required'
  selection_err_3:
    CommandLine|contains: 'CAPTCHA'
  selection_err_4:
    CommandLine|contains: 'Click Allow'

  condition: selection_click and selection_ps and selection_obf

falsepositives:
  - Uncommon but legitimate scripted PowerShell usage with similar wording
level: high
