title: macOS Password Harvesting via osascript
id: c4d6c979-86f0-4d2d-a324-44bc5df1b92b
status: experimental
description: |
    Detects AppleScript execution attempting to harvest user passwords through
    dialog boxes with hidden answer parameters, commonly used by macOS infostealers
    like Poseidon, and Banshee stealers.
references:
    - https://www.sentinelone.com/blog/2024-macos-malware-review-infostealers-backdoors-and-apt-campaigns-targeting-the-enterprise/
    - https://objective-see.org/blog/blog_0x7D.html

tags:
    - attack.credential-access
    - attack.t1555.001  # Keychain
logsource:
    product: macos
    category: process_creation
detection:
    selection_osascript:
        Image|endswith: '/osascript'
        CommandLine|contains: 'display dialog'
    selection_password_harvest:
        CommandLine|contains|all:
            - 'hidden answer'
            - 'default answer'
    selection_common_lures:
        CommandLine|contains:
            - 'Enter Password'
            - 'password to proceed'
            - 'Preview needs permissions'
            - 'critical error'
            - 'suspicious activity'
    condition: >-
      selection_osascript and selection_password_harvest 
      or selection_common_lures
level: high
